-- test-run result file version 2

-- write data recover from latest snapshot
env = require('test_run')
 | ---
 | ...
test_run = env.new()
 | ---
 | ...
test_run:cmd('create server test with script="box/choose_memtx_allocator.lua"')
 | ---
 | - true
 | ...
--test small allocator
test_run:cmd('start server test with args="small"')
 | ---
 | - true
 | ...
test_run:cmd('switch test')
 | ---
 | - true
 | ...
space = box.schema.space.create('test')
 | ---
 | ...
space:format({ {name = 'id', type = 'unsigned'}, {name = 'year', type = 'unsigned'} })
 | ---
 | ...
s = space:create_index('primary', { parts = {'id'} })
 | ---
 | ...
for key = 1, 1000 do space:insert({key, key + 1000}) end
 | ---
 | ...
for key = 1, 1000 do space:replace({key, key + 5000}) end
 | ---
 | ...
for key = 1, 1000 do space:delete(key) end
 | ---
 | ...
space:drop()
 | ---
 | ...
test_run:cmd('switch default')
 | ---
 | - true
 | ...
test_run:cmd('stop server test')
 | ---
 | - true
 | ...
--test system(malloc) allocator
test_run:cmd('start server test with args="system"')
 | ---
 | - true
 | ...
space = box.schema.space.create('test')
 | ---
 | ...
space:format({ {name = 'id', type = 'unsigned'}, {name = 'year', type = 'unsigned'} })
 | ---
 | ...
s = space:create_index('primary', { parts = {'id'} })
 | ---
 | ...
for key = 1, 1000 do space:insert({key, key + 1000}) end
 | ---
 | ...
for key = 1, 1000 do space:replace({key, key + 5000}) end
 | ---
 | ...
for key = 1, 1000 do space:delete(key) end
 | ---
 | ...
space:drop()
 | ---
 | ...
test_run:cmd('switch default')
 | ---
 | - true
 | ...
test_run:cmd('stop server test')
 | ---
 | - true
 | ...
--test default (small) allocator
test_run:cmd('start server test')
 | ---
 | - true
 | ...
test_run:cmd('switch test')
 | ---
 | - true
 | ...
space = box.schema.space.create('test')
 | ---
 | ...
space:format({ {name = 'id', type = 'unsigned'}, {name = 'year', type = 'unsigned'} })
 | ---
 | ...
s = space:create_index('primary', { parts = {'id'} })
 | ---
 | ...
for key = 1, 1000 do space:insert({key, key + 1000}) end
 | ---
 | ...
for key = 1, 1000 do space:replace({key, key + 5000}) end
 | ---
 | ...
for key = 1, 1000 do space:delete(key) end
 | ---
 | ...
space:drop()
 | ---
 | ...
test_run:cmd('switch default')
 | ---
 | - true
 | ...
test_run:cmd('stop server test')
 | ---
 | - true
 | ...
test_run:cmd('cleanup server test')
 | ---
 | - true
 | ...
test_run:cmd('delete server test')
 | ---
 | - true
 | ...
